var A=Object.create;var n=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,x=Object.prototype.hasOwnProperty;var E=(e,o)=>{for(var s in o)n(e,s,{get:o[s],enumerable:!0})},l=(e,o,s,a)=>{if(o&&typeof o=="object"||typeof o=="function")for(let r of w(o))!x.call(e,r)&&r!==s&&n(e,r,{get:()=>o[r],enumerable:!(a=R(o,r))||a.enumerable});return e};var p=(e,o,s)=>(s=e!=null?A(y(e)):{},l(o||!e||!e.__esModule?n(s,"default",{value:e,enumerable:!0}):s,e)),P=e=>l(n({},"__esModule",{value:!0}),e);var B={};E(B,{autenticacaoController:()=>h});module.exports=P(B);var g=require("knex"),T={client:"pg",connection:{host:process.env.DATABASE_HOST,port:Number(process.env.DATABASE_PORT),user:process.env.DATABASE_USER,password:process.env.DATABASE_PASSWORD,database:process.env.DATABASE_NAME}},b=(0,g.knex)(T),f=b;var i=class{async getProfissional(o){try{return{status:200,messageClient:"Profissional encontrado",messageServer:await f.select("*").from("profissional").where({email:o,ativo:1})}}catch(s){return{status:500,messageClient:"Erro ao buscar profissionais !",messageServer:s}}}},S=new i;var v=p(require("bcrypt")),d=p(require("jsonwebtoken")),m=class{async login(o,s){let{email:a,password:r}=o.body;console.log(a,r);let t=await S.getProfissional(a);if(console.log(t),t.status===500)return s.status(500).send({message:"Internal server error"});if(t.messageServer.length===0)return s.status(404).send({message:"User not found"});console.log(t.messageServer[0].senha);let c=await v.default.compare(r,t.messageServer[0].senha);if(console.log(c),c){let u=d.default.sign({email:t.messageServer[0].email,name:t.messageServer[0].nm_profissional,permissions:["admin"]},"secret",{expiresIn:"1d"});return console.log(u),s.status(200).send({message:"Login Realizado com sucesso",token:u,userInformation:t.messageServer[0]})}return s.status(401).send({message:"Sem login pra voc\xEA amigo !"})}},h=new m;0&&(module.exports={autenticacaoController});
